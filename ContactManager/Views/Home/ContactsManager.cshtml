@model IEnumerable<ContactManager.Models.ContactViewModel>
<html>
<head>
    <link href="~/Content/fontawesome-all.css" rel="stylesheet" />
    <script src="~/js/jquery-2.0.0.min.js"></script>
    <style>
        .active-pink-2 input[type=text]:focus:not([readonly]) {
            border-bottom: 1px solid #f48fb1;
            box-shadow: 0 1px 0 0 #f48fb1;
        }

        .active-pink input[type=text] {
            border-bottom: 1px solid #f48fb1;
            box-shadow: 0 1px 0 0 #f48fb1;
        }

        .active-purple-2 input[type=text]:focus:not([readonly]) {
            border-bottom: 1px solid #ce93d8;
            box-shadow: 0 1px 0 0 #ce93d8;
        }

        .active-purple input[type=text] {
            border-bottom: 1px solid #ce93d8;
            box-shadow: 0 1px 0 0 #ce93d8;
        }

        .active-cyan-2 input[type=text]:focus:not([readonly]) {
            border-bottom: 1px solid #4dd0e1;
            box-shadow: 0 1px 0 0 #4dd0e1;
        }

        .active-cyan input[type=text] {
            border-bottom: 1px solid #4dd0e1;
            box-shadow: 0 1px 0 0 #4dd0e1;
        }

        .active-cyan, .active-cyan-2 {
            color: #4dd0e1;
        }

        .active-purple .fa, .active-purple-2 .fa {
            color: #ce93d8;
        }

        .active-pink .fa, .active-pink-2 .fa {
            color: #f48fb1;
        }
    </style>
</head>
<body>
    <div class="row">
        <div class="col-12">
            <div class="form-inline md-form form-sm active-cyan-2">
                <div class="form-group" id="searchbar">
                    <input class="form-control form-control-lg mr-3 w-100" id="search" type="text" placeholder="Search Contacts" aria-label="Search">
                    <i class="fa fa-search" aria-hidden="true"></i>
                </div>
                <div>
                    <button id="addbutton" class="btn-outline-primary"><i class="fas fa-plus"></i>  Add New Contact</button>
                    @*<button id="edit" class="btn btn-primary"> <i class="fa fa-edit"></i></button>*@
                </div>
            </div>
        </div>
    </div>
    @*<div id="partialViewHolder" style="display:none">Ajax content goes here after initial page loads, but it is hidden until then</div>*@


    @Html.Partial("ShowContact", Model);


    <div id="myModal" class="modal">
        <!-- Modal content -->
        <div class="modal-content">
            <div>
                <span class="close">&times;</span>
            </div>
            <fieldset>
                <legend>New Contact</legend>
                <form class="form-inline" id="newContact" name="newContact" action="@Url.Action("CreateNewContact","Home")">
                    <div class="input-group mb-lg-2">
                        <div class="input-group-prepend">
                            <span class="input-group-text" id="basic-addon3">First Name:</span>
                        </div>
                        <input type="text" class="form-control" id="FirstName" name="FirstName" placeholder="First Name Here!" aria-describedby="basic-addon3">
                    </div>
                    <div class="input-group mb-lg-2">
                        <div class="input-group-prepend">
                            <span class="input-group-text" id="basic-addon3">Last Name:</span>
                        </div>
                        <input type="text" class="form-control" id="LastName" placeholder="Last Name Here!" name="LastName" aria-describedby="basic-addon3">
                        <hr />
                    </div>

                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text" id="basic-addon3">BirthDate:</span>
                        </div>
                        <input type="date" class="form-control" id="Birthdate" name="BirthDate" aria-describedby="basic-addon3">
                        <hr />
                    </div>
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text" id="basic-addon3">Phone Number:</span>
                        </div>
                        <input type="text" class="form-control" id="CellPhone" name="CellPhone" placeholder="XXX-XXX-XXXX" aria-describedby="basic-addon3">
                        <hr />
                    </div>
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text" id="basic-addon3">Work Number:</span>
                        </div>
                        <input type="text" class="form-control" id="WorkPhone" name="WorkPhone" placeholder="XXX-XXX-XXXX" aria-describedby="basic-addon3">
                        <hr />
                    </div>
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text" id="basic-addon3">Fax Number:</span>
                        </div>
                        <input type="text" class="form-control" id="FaxNumber" name="FaxNumber" placeholder="XXX-XXX-XXXX" aria-describedby="basic-addon3">
                        <hr />
                    </div>
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text" id="basic-addon3">Street Address:</span>
                        </div>
                        <input type="text" class="form-control" id="Address" name="Address" placeholder="Street Address" aria-describedby="basic-addon3">
                        <hr />
                    </div>
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text" id="basic-addon3">City:</span>
                        </div>
                        <input type="text" class="form-control" id="City" name="City" placeholder="City" required aria-describedby="basic-addon3">
                        <hr />
                    </div>
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text" id="basic-addon3">State:</span>
                        </div>
                        <input type="text" class="form-control" maxlength="2" id="State" name="State" placeholder="State" aria-describedby="basic-addon3">
                        <hr />
                    </div>
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text" id="basic-addon3">ZipCode:</span>
                        </div>
                        <input type="text" class="form-control" id="ZipCode" maxlength="5" name="ZipCode" placeholder="Zip Code" aria-describedby="basic-addon3">
                        <hr />
                    </div>
                </form>
                <div class="text-center">
                    <button id="addbutton" type="submit" class="btn-outline-primary" onclick="CreateNewContact()"><i class="fas fa-plus"></i>  Create New Contact </button>
                </div>
            </fieldset>
        </div>
    </div>

    <div id="editModal" class="modal">
        <!-- Modal content -->
        <div class="modal-content">
            <div>
                <span class="editClose">&times;</span>
            </div>
            <fieldset>
                <legend>Edit Contact</legend>
                <form class="form-inline" id="editContact" name="editContact" action="@Url.Action("EditContact","Home")">
                    <div class="input-group mb-lg-2">
                        <div class="input-group-prepend">
                            <span class="input-group-text" id="basic-addon3">First Name:</span>
                        </div>
                        <input type="text" class="form-control" id="FirstNameEdit" name="FirstName" placeholder="First Name Here!" aria-describedby="basic-addon3">
                    </div>
                    <div class="input-group mb-lg-2">
                        <div class="input-group-prepend">
                            <span class="input-group-text" id="basic-addon3">Last Name:</span>
                        </div>
                        <input type="text" class="form-control" id="LastNameEdit" placeholder="Last Name Here!" name="LastName" aria-describedby="basic-addon3">
                        <hr />
                    </div>

                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text" id="basic-addon3">BirthDate:</span>
                        </div>
                        <input type="date" class="form-control" id="BirthdateEdit" name="BirthDate" aria-describedby="basic-addon3">
                        <hr />
                    </div>
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text" id="basic-addon3">Phone Number:</span>
                        </div>
                        <input type="text" class="form-control" id="CellPhoneEdit" name="CellPhone" aria-describedby="basic-addon3">
                        <hr />
                    </div>
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text" id="basic-addon3">Work Number:</span>
                        </div>
                        <input type="text" class="form-control" id="WorkPhoneEdit" name="WorkPhone" aria-describedby="basic-addon3">
                        <hr />
                    </div>
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text" id="basic-addon3">Fax Number:</span>
                        </div>
                        <input type="text" class="form-control" id="FaxNumberEdit" name="FaxNumber" aria-describedby="basic-addon3">
                        <hr />
                    </div>
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text" id="basic-addon3">Street Address:</span>
                        </div>
                        <input type="text" class="form-control" id="AddressEdit" name="Address" aria-describedby="basic-addon3">
                        <hr />
                    </div>
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text" id="basic-addon3">City:</span>
                        </div>
                        <input type="text" class="form-control" id="CityEdit" name="City" placeholder="City" required aria-describedby="basic-addon3">
                        <hr />
                    </div>
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text" id="basic-addon3">State:</span>
                        </div>
                        <input type="text" class="form-control" id="StateEdit" name="State" aria-describedby="basic-addon3">
                        <hr />
                    </div>
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text" id="basic-addon3">ZipCode:</span>
                        </div>
                        <input type="text" class="form-control" id="ZipCodeEdit" name="ZipCode" aria-describedby="basic-addon3">
                        <hr />
                    </div>
                </form>
                <div class="text-center">
                    <button id="editButtonModal" value="0" class="btn-outline-primary" onclick="EditContact()"><i class="fas fa-plus"></i>  Edit Contact </button>
                </div>
            </fieldset>
        </div>
    </div>
    <div id="deleteModal" class="modal">
        <!-- Modal content -->
        <div class="modal-content">
            <div>
                <span class="deleteClose">&times;</span>
            </div>
            <fieldset>
                <legend>Delete Contact</legend>
                <form class="form-inline" id="deleteContact" name="deleteContact" action="@Url.Action("DeleteContact","Home")">
                    <input type="hidden" id="deleteContactID" value="0" />

                </form>
                <span class="alert-info"> Are you sure you want to delete this contact?</span>
                <div class="text-center">
                    <button id="deletebuttonModal" value="0" class="btn-outline-primary" onclick="DeleteContact()"><i class="fas fa-plus"></i>  Delete Contact </button>
                </div>
            </fieldset>
        </div>
    </div>


</body>
</html>
<style>
    #myModal {
        width: auto;
    }

    #basic-url {
        padding: 5px;
    }

    .input-group mb-lg-2 {
        margin: 15px;
    }

    input {
        margin-right: 20px;
    }

    fieldset {
        border: 1px solid #007bff !important;
        margin: 0;
        xmin-width: 0;
        padding: 10px;
        position: relative;
        border-radius: 4px;
        background-color: #f5f5f5;
        padding-left: 10px !important;
    }

    legend {
        font-size: 14px;
        font-weight: bold;
        margin-bottom: 0px;
        width: 35%;
        border: 1px solid #ddd;
        border-radius: 4px;
        padding: 5px 5px 5px 10px;
        background-color: #007bff;
    }
    /* The Modal (background) */
    .modal {
        display: none; /* Hidden by default */
        position: fixed; /* Stay in place */
        z-index: 1; /* Sit on top */
        left: 0;
        top: 0;
        width: 100%; /* Full width */
        height: 100%; /* Full height */
        overflow: auto; /* Enable scroll if needed */
        background-color: rgb(0,0,0); /* Fallback color */
        background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
    }

    /* Modal Content/Box */
    .modal-content {
        background-color: #f5f5f5;
        margin: 15% auto; /* 15% from the top and centered */
        padding: 20px;
        border: 1px solid #007bff;
        width: 50%; /* Could be more or less, depending on screen size */
    }

    /* The Close Button */
    .close {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
    }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

    .fa {
        color: #fffff;
    }

    #searchbar {
        width: 500px;
        padding: 10px;
        margin: 0 auto;
    }

        #searchbar input, select, textarea {
            max-width: 450px;
        }

    .btn-primary {
        color: #fff;
        background-color: #5bc0de;
        border-color: #5bc0de;
    }
</style>
<script>
    // Get the modal
    var modal = document.getElementById('myModal');
    var editModal = document.getElementById('editModal');
    var deleteModal = document.getElementById('deleteModal');

    // Get the button that opens the modal
    var btn = document.getElementById("addbutton");


    // button to sumbit edit and delete modals (triggers ajax call)
    var editBtn = document.getElementById("editButtonModal");
    var deleteBtn = document.getElementById("deletebuttonModal");

    // Get the <span> element that closes the modal
    var span = document.getElementsByClassName("close")[0];
    var editSpan = document.getElementsByClassName("editClose")[0];
    var deleteSpan = document.getElementsByClassName("deleteClose")[0];

    var deleteBtn = document.getElementById("deleteContactID");



    var FirstNameEdit = document.getElementById("FirstNameEdit");
    var LastNameEdit = document.getElementById("LastNameEdit");
    var WorkPhoneEdit = document.getElementById("WorkPhoneEdit");
    var CellPhoneEdit = document.getElementById("CellPhoneEdit");
    var AddressEdit = document.getElementById("AddressEdit");
    var CityEdit = document.getElementById("CityEdit");
    var StateEdit = document.getElementById("StateEdit");







    // When the user clicks on the button, open the modal
    btn.onclick = function () {
        modal.style.display = "block";
    }



    function EditContactModalClick(contactId,FirstName,LastName,WorkPhone,CellPhone,Address,City,State) {

        editModal.style.display = "block";

        // set the ID in the modal form
        editBtn.setAttribute("value", contactId);


        $("#FirstNameEdit").val(FirstName);
        $("#LastNameEdit").val(LastName);
        $("#WorkPhoneEdit").val(WorkPhone);
        $("#CellPhoneEdit").val(CellPhone);
        $("#AddressEdit").val(Address);
        $("#CityEdit").val(City);
        $("#StateEdit").val(State);



    }



    function DeleteContactModalClick(contactId) {
        deleteModal.style.display = "block";

        // set the ID in the modal form
        deleteBtn.setAttribute("value", contactId);

    }



    // When the user clicks on <span> (x), close the modal
    span.onclick = function () {
        modal.style.display = "none";
    }
    editSpan.onclick = function () {
        editModal.style.display = "none";
    }
    deleteSpan.onclick = function () {
        deleteModal.style.display = "none";
    }


    // When the user clicks anywhere outside of the modal, close it
    window.onclick = function (event) {
        if (event.target == modal) {
            modal.style.display = "none";
        }
        else if (event.target == editModal) {
            editModal.style.display = "none";
        }
        else if (event.target == deleteModal) {
            deleteModal.style.display = "none";
        }

    }
    $(window).load(function () {
        $("#partialViewHolder").load("@Url.Content("/Home/ShowContact")");
        $("#partialViewHolder").show();
    });

    function CreateNewContact() {
        //debugger;
        $("#newContact").submit();

    }

    function EditContact() {
        // use ajax here
        var callbackUrl = '/Home/EditContact';

        var editTemplate = {
            contactID: editBtn.getAttribute("value"),

            FirstName: $("#FirstNameEdit").val(),
            LastName: $("#LastNameEdit").val(),
            WorkPhone: $("#WorkPhoneEdit").val(),
            CellPhone: $("#CellPhoneEdit").val(),
            Address: $("#AddressEdit").val(),
            City: $("#CityEdit").val(),
            State: $("#StateEdit").val()
        }

        $.ajax({
            url: callbackUrl,
            type: "post",
            data: { editContactJson: JSON.stringify(editTemplate) },
            dataType: "html",
            async: false,
            success: function (partialView) {

                $('#ajaxTest').replaceWith(partialView);

            },
            error: function (jqXHR, textStatus, errorThrown) {
                alert(errorThrown);
            }
        });

        editModal.style.display = "none";

    }

    function DeleteContact() {
        // use ajax here
        var callbackUrl = '/Home/DeleteContact';

        var ID = {
            contactID: deleteBtn.getAttribute("value")
        }

        $.ajax({
            url: callbackUrl,
            type: "post",
            data: { contactID: JSON.stringify(ID) },
            dataType: "html",
            async: false,
            success: function (partialView) {

                $('#ajaxTest').replaceWith(partialView);

            },
            error: function (jqXHR, textStatus, errorThrown) {
                alert(errorThrown);
            }
        });

        deleteModal.style.display = "none";

    }





    $('#search').keyup(function () {
        //debugger
        var input = document.getElementById('search');
        var filter = input.value.toUpperCase();
        var card = document.getElementsByClassName('card');
        for (i = 0; i < card.length; i++) {
            a = card[i].getElementsByTagName("h2")[0];
            if (a.innerHTML.toUpperCase().indexOf(filter) > -1) {
                card[i].style.display = "";
            } else {
                card[i].style.display = "none";

            }
        }
    })
    function phone_formatting(ele, restore) {
        var new_number,
            selection_start = ele.selectionStart,
            selection_end = ele.selectionEnd,
            number = ele.value.replace(/\D/g, '');

        // automatically add dashes
        if (number.length > 2) {
            // matches: 123 || 123-4 || 123-45
            new_number = number.substring(0, 3) + '-';
            if (number.length === 4 || number.length === 5) {
                // matches: 123-4 || 123-45
                new_number += number.substr(3);
            }
            else if (number.length > 5) {
                // matches: 123-456 || 123-456-7 || 123-456-789
                new_number += number.substring(3, 6) + '-';
            }
            if (number.length > 6) {
                // matches: 123-456-7 || 123-456-789 || 123-456-7890
                new_number += number.substring(6);
            }
        }
        else {
            new_number = number;
        }

        // if value is heigher than 12, last number is dropped
        // if inserting a number before the last character, numbers
        // are shifted right, only 12 characters will show
        ele.value = (new_number.length > 12) ? new_number.substring(0, 12) : new_number;

        // restore cursor selection,
        // prevent it from going to the end
        // UNLESS
        // cursor was at the end AND a dash was added
        document.getElementById('msg').innerHTML = '<p>Selection is: ' + selection_end + ' and length is: ' + new_number.length + '</p>';

        if (new_number.slice(-1) === '-' && restore === false
            && (new_number.length === 8 && selection_end === 7)
            || (new_number.length === 4 && selection_end === 3)) {
            selection_start = new_number.length;
            selection_end = new_number.length;
        }
        else if (restore === 'revert') {
            selection_start--;
            selection_end--;
        }
        ele.setSelectionRange(selection_start, selection_end);

    }

    function phone_number_check(field, e) {
        var key_code = e.keyCode,
            key_string = String.fromCharCode(key_code),
            press_delete = false,
            dash_key = 189,
            delete_key = [8, 46],
            direction_key = [33, 34, 35, 36, 37, 38, 39, 40],
            selection_end = field.selectionEnd;

        // delete key was pressed
        if (delete_key.indexOf(key_code) > -1) {
            press_delete = true;
        }

        // only force formatting is a number or delete key was pressed
        if (key_string.match(/^\d+$/) || press_delete) {
            phone_formatting(field, press_delete);
        }
        // do nothing for direction keys, keep their default actions
        else if (direction_key.indexOf(key_code) > -1) {
            // do nothing
        }
        else if (dash_key === key_code) {
            if (selection_end === field.value.length) {
                field.value = field.value.slice(0, -1)
            }
            else {
                field.value = field.value.substring(0, (selection_end - 1)) + field.value.substr(selection_end)
                field.selectionEnd = selection_end - 1;
            }
        }
        // all other non numerical key presses, remove their value
        else {
            e.preventDefault();
            //    field.value = field.value.replace(/[^0-9\-]/g,'')
            phone_formatting(field, 'revert');
        }

    }

    document.getElementById('CellPhone').onkeyup = function (e) {
        phone_number_check(this, e);
    }
   
    $('#signout').click(function () {
        //debugger;
        window.location = '/Home/Index';
    });
</script>

